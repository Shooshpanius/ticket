<%= javascript_include_tag "tickets" %>

<p>
  <a class="btn btn-primary" type="button" href="/tickets/ticket_new/"><i class="icon-plus"></i>Создать заявку</a>
</p>


<table class="table table-hover table-bordered table-condensed">
  <caption>Входящие персональные (10 последних)</caption>
  <thead>
  <tr>
    <th class="span3">Инициатор</th>
    <th>Тема</th>
    <th class="span2">Срок исполнения</th>
    <th class="span1"></th>
  </tr>
  </thead>
  <tbody>
    <% @user_tickets.each do |user_tickets| %>
    <% user_data = User.find(user_tickets.initiator_id) %>
        <tr>
            <td><%= user_data.login %></td>
            <td><%= user_tickets.topic %></td>
            <td><%= user_tickets.deadline.strftime("%d-%m-%Y") %></td>
            <td>
              <a class="btn btn-mini btn-primary" type="button" href="/tickets/ticket_edit/u_<%= user_tickets.id %>"><i class="icon-edit"></i></a>
            </td>
        </tr>
    <% end %>
  </tbody>
</table>


<table class="table table-hover table-bordered table-condensed">
  <caption>Входящие групповые (10 последних)</caption>
  <thead>
  <tr>
    <th class="span3">Инициатор</th>
    <th class="span3">Группа</th>
    <th>Тема</th>
    <th class="span2">Срок исполнения</th>
    <th class="span1"></th>
  </tr>
  </thead>
  <tbody>
  <% @group_tickets.each do |group_tickets| %>
      <% user_data = User.find(group_tickets.initiator_id) %>
      <% group_data = Group.find(group_tickets.group_id) %>
      <tr>
        <td><%= user_data.login %></td>
        <td><%= group_data.name %></td>
        <td><%= group_tickets.topic %></td>
        <td><%= group_tickets.deadline.strftime("%d-%m-%Y") %></td>
        <td>
          <a class="btn btn-mini btn-primary" type="button" href="/tickets/ticket_edit/g_<%= group_tickets.id %>"><i class="icon-edit"></i></a>
        </td>
      </tr>
  <% end %>
  </tbody>
</table>



<table class="table table-hover table-bordered table-condensed">
  <caption>Исходящие (10 последних)</caption>
  <thead>
  <tr>
    <th class="span3">Исполнитель</th>
    <th>Тема</th>
    <th class="span2">Срок исполнения</th>
    <th class="span1"></th>
  </tr>
  </thead>
  <tbody>
  <% @my_tickets.each do |my_tickets| %>
      <% if my_tickets.respond_to?(:groups_id)  %>
          <% user_data = User.find(my_tickets.initiator_id) %>
          <% group_data = Group.find(my_tickets.group_id) %>
          <tr>
            <td><%= group_data.name %></td>
            <td><%= my_tickets.topic %></td>
            <td><%= my_tickets.deadline.strftime("%d-%m-%Y") %></td>
            <td>
              <a class="btn btn-mini btn-primary" type="button" href="/tickets/ticket_edit/g_<%= my_tickets.id %>"><i class="icon-edit"></i></a>
            </td>
          </tr>
      <% else  %>
          <% user_data = User.find(my_tickets.initiator_id) %>
          <tr>
            <td><%= user_data.login %></td>
            <td><%= my_tickets.topic %></td>
            <td><%= my_tickets.deadline.strftime("%d-%m-%Y") %></td>
            <td>
              <a class="btn btn-mini btn-primary" type="button" href="/tickets/ticket_edit/u_<%= my_tickets.id %>"><i class="icon-edit"></i></a>
            </td>
          </tr>
      <% end  %>


  <% end %>
  </tbody>
</table>